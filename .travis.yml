---
jobs:
  include:
    - &test
      stage: test
      language: python
      python: "2.7"
      cache: pip
      dist: xenial
      sudo: required
      install:
        - .travis/setup.sh
      script:
        # the python venv needs to be in the path for molecule to run
        # https://unix.stackexchange.com/questions/83191/how-to-make-sudo-preserve-path
        - ls -clash /proc/self/uid_map
        - ls -clash /proc/self/gid_map
        - ls -clash /proc/self/ns/user
        - sudo env "PATH=$PATH" molecule dependency
        - sudo env "PATH=$PATH" molecule create
        - sudo env "PATH=$PATH" lxc exec ubuntu-xenial cat /etc/subuid
        - sudo env "PATH=$PATH" molecule test

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
